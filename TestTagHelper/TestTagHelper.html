<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Test TagHelper – External API Demo</title>
    <link href="./TestTagHelper.css" rel="stylesheet" />
    <style>
        .status-line {
            font-weight: bold;
            color: #777;
            transition: color 0.4s;
        }

            .status-line.active {
                color: green;
            }

        .test-panel {
            margin-bottom: 1rem;
            background: #f8f8f8;
            padding: 1em;
            border: 1px solid #ddd;
        }

        button {
            padding: 6px 12px;
            margin-right: 0.5em;
        }
    </style>
</head>
<body>

    <!-- 🔧 External UI: interacts with component from outside -->
    <section class="test-panel">
        <h3>External Interaction</h3>
        <p>This panel demonstrates invoking component APIs and hooks from outside.</p>
        <button type="button" onclick="callComponentApi()">🔁 Call sayHello()</button>
        <button type="button" onclick="triggerInitHook()">🚀 Trigger onInit()</button>
        <div class="status-line" id="hook-status">⏳ Awaiting onInit...</div>
    </section>

    <!-- 🧩 Razor-rendered component -->
    <tag-helper id="hello-card">
        <div class="hello-card">
            <h2>@_Welcome_</h2>
            <p>@_Intro_</p>
            <div class="time-block">
                @_Now_: {{CurrentTime}}
            </div>
            <button type="button" onclick="helloCard.sayHello()">@_ClickMe_</button>
        </div>

        <script>
            // ✅ Define the internal hook
            window.Instancium = window.Instancium || {};
            Instancium.ComponentHooks = Instancium.ComponentHooks || {};

            Instancium.ComponentHooks["hello-card"] = {
                onInit: (el) => {
                    const status = document.getElementById("hook-status");
                    if (status) {
                        status.textContent = "✅ Hook fired at " + new Date().toLocaleTimeString();
                        status.classList.add("active");
                        setTimeout(() => status.classList.remove("active"), 800);
                    }
                    console.log("🔄 onInit triggered for", el);
                }
            };

            // ✅ Define the component’s public API
            window.helloCard = {
                sayHello: () => alert("👋 Hello from inside the component!")
            };
        </script>
    </tag-helper>

    <!-- 💡 External JS calls the component API -->
    <script>
        function callComponentApi() {
            const api = window.helloCard;
            if (api?.sayHello) {
                api.sayHello();
            } else {
                alert("Component API is not yet available.");
            }
        }

        function triggerInitHook() {
            const hook = window.Instancium?.ComponentHooks?.["hello-card"];
            const el = document.getElementById("hello-card");
            if (hook?.onInit && el) {
                hook.onInit(el);
            } else {
                alert("Hook not registered or component not found.");
            }
        }

        // Run automatically on load for testing (can be removed in prod)
        document.addEventListener("DOMContentLoaded", () => {
            triggerInitHook();
        });
    </script>

</body>
</html>
